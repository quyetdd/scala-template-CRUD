/*
 * Scala bean class for entity table ${entity.databaseTable} 
 * Created on $today.date ( Date ISO $today.date("yyyy-MM-dd") - Time $today.time )
 * Generated by quyetddd ( version $generator.version )
 */

package ${target.javaPackageFromFolder(${SRC})}

import play.api.Play.current
import play.api._
import play.api.mvc._
import play.api.db._

#foreach( $import in $java.imports($entity) )
import $import
#end

/**
 * CRUD Entity bean for table "${entity.databaseTable}"
 * 
 * @author quyetdd Tools Generator
 *
 */

object $entity.name {

    case class ${entity.name}(
#foreach( $field in $entity.keyAttributes )
    $field.formattedName(0):#if($field.type=="int")Int #else $field.type #end
#end

#foreach( $field in $entity.nonKeyAttributes )
   , $field.formattedName(0):#if($field.type=="int")Int #else $field.type #end
    
#end
)
  case class Paging_${entity.name}(obj:$entity.name,total:Long)
//----------------------------------------------------------------------
// CRUD
//----------------------------------------------------------------------

//List
  def getList(page: Int, record: Int, order: String, sort: String, where: String, operator: String): List[Paging_$entity.name] = {
    val outString = ""
    var count=0
    var list = List[Paging_$entity.name]()
    var where_str=""
   // if(operator != "")
   //   where_str = order + operator + where
    val conn = DB.getConnection()
    try {

      val stmt = conn.createStatement
      var page_1 = page
      if(page_1 <= 0)
        page_1 = 1
      val start = (( record * page_1 ) - record)    
      val rs_count = stmt.executeQuery("SELECT count(#foreach($field in $entity.keyAttributes)$field.formattedName(0)#end) as count from $entity.name " + where_str)
      while (rs_count.next()) {
       count = rs_count.getInt("count")
      }
      val rs = stmt.executeQuery("SELECT * from ${entity.name} " + where_str + " order by " + order + " " + sort + " limit " + start + "," + record)

      while (rs.next()) {
        val pes = new ${entity.name}(
#foreach( $field in $entity.keyAttributes )
   #if($field.type=="int")rs.getInt("$field.formattedName(0)") #else rs.get${field.type}("$field.formattedName(0)")#end
#end

#foreach( $field in $entity.nonKeyAttributes )
    ,#if($field.type=="int")rs.getInt("$field.formattedName(0)") #else rs.get${field.type}("$field.formattedName(0)")#end
    
#end
)
        list = list :+ Paging_${entity.name}(pes,count)

      }
    } finally {
      conn.close()
    }

    return list
  }

//Insert
  def insert(obj:${entity.name}): Boolean = {
    val outString = ""
    var count=0
    var list = List[Paging_$entity.name]()
    val where_str=""
   //  if(operator != "")
   //   where_str = order + operator + where
    val conn = DB.getConnection()
    try {
      val stmt = conn.createStatement
      val sql="Insert into ${entity.name}(#foreach( $field in $entity.keyAttributes )$field.formattedName(0)#end #foreach( $field in $entity.nonKeyAttributes ),$field.formattedName(0)#end) values ("#foreach( $field in $entity.keyAttributes ) +obj.$field.formattedName(0)+"#end #foreach( $field in $entity.nonKeyAttributes ),"+obj.$field.formattedName(0)+"#end)"
      val rs_count = stmt.executeQuery(sql)
              return true;
    }catch {
      case t: Throwable =>false // TODO: handle error
    } finally {
      conn.close()
    }
  }
//Update
  def update(obj:${entity.name}): Boolean = {
    Boolean 
    val outString = ""
    var count=0
    var list = List[Paging_$entity.name]()
    val where_str=""
   //  if(operator != "")
   //   where_str = order + operator + where
    val conn = DB.getConnection()
    try {
      val stmt = conn.createStatement
      val sql="Update ${entity.name} set #foreach($field in $entity.nonKeyAttributes )$field.formattedName(0)="+obj.$field.formattedName(0)+", #end where #foreach( $field in $entity.keyAttributes )$field.formattedName(0)="+obj.$field.formattedName(0)#end

      val rs_count = stmt.executeQuery(sql)
     
        return true;
    }catch {
      case t: Throwable =>false // TODO: handle error
    } finally {
      conn.close()
    }
  }
  //Delete
  def delete(id: #foreach( $field in $entity.keyAttributes )#if($field.type=="int")Int#else$field.type#end
#end): Boolean = {
    Boolean 
    val outString = ""
    var count=0
    var list = List[Paging_$entity.name]()
    val where_str=""
   //  if(operator != "")
   //   where_str = order + operator + where
    val conn = DB.getConnection()
    try {
      val stmt = conn.createStatement
      val sql="Delete from ${entity.name} where #foreach( $field in $entity.keyAttributes )$field.formattedName(0)#end="+id
      val rs_count = stmt.executeQuery(sql)
        return true;
    }catch {
      case t: Throwable =>false // TODO: handle error
    } finally {
      conn.close()
    }
  }
}

